<article class="fluid-container ">
    <div class="row col-md-12 title">
        <div class=" col-md-6">
            <h2>Consulta Pedido</h2>
        </div>
        <div class=" col-md-6" style="text-align: right;">
            <button mat-stroked-button aria-label="Export XLS" class="color_green" >
                <mat-icon>insert_drive_file</mat-icon>Exportar XLS
            </button>
        </div>
    </div>


    <div class="row col-md-12">
        <div class=" col-md-12">
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <p>B&uacute;squeda</p>
                    </mat-panel-title>
                    <mat-panel-description>
                        Filtro para b&uacute;squeda de pedidos
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <div class="row col-md-12">
                    <div class=" col-md-4">
                        <mat-form-field class="full-width">
                            <mat-label>Folio</mat-label>
                            <input matInput placeholder="Introduce folio"  name="folio" [(ngModel)]="filter.folio"/>
                        </mat-form-field>
                    </div>
                    <div class=" col-md-4">
                        <mat-form-field class="full-width">
                            <mat-label>Cliente</mat-label>
                            <input matInput placeholder="Nombre del Cliente" name="cliente" [(ngModel)]="filter.cliente" />
                        </mat-form-field>
                    </div>
                    <div class=" col-md-4">
                        <mat-form-field class="full-width">
                            <mat-label>Estatus</mat-label>
                            <mat-select  placeholder="Estatus del pedido" name="estatus" [(ngModel)]="filter.estatus">
                                <mat-option *ngFor="let item of listCatStatus" 
                                value="{{item.id_estatus}}">{{item.estatus}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row col-md-12">

                    <div class=" col-md-4 col-xs-6">
                        <mat-form-field class="full-width">
                            
                            <mat-label>Fecha Pedido Inicial</mat-label>
                            <input matInput [matDatepicker]="dateIni" 
                                name="fecIni" [(ngModel)]="filter.fecIni" disabled />
                            <mat-datepicker-toggle matSuffix [for]="dateIni" ></mat-datepicker-toggle>
                            <mat-datepicker #dateIni disabled="false"></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class=" col-md-4 col-xs-6">
                        <mat-form-field class="full-width"> 
                            <mat-label>Fecha Pedido Final</mat-label>
                            <input matInput [matDatepicker]="dateFin" 
                                name="fecFin" [(ngModel)]="filter.fecFin" disabled/>
                            <mat-datepicker-toggle matSuffix [for]="dateFin" ></mat-datepicker-toggle>
                            <mat-datepicker #dateFin disabled="false"></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class=" col-md-4">
                        
                    </div>
                </div>
                <div class=" col-md-12" style="text-align:center">
                    <!--Botones de limpiar y buscar-->
                    <button mat-raised-button color="primary" (click)="filterOrder()">
                        Buscar</button>
                    &nbsp;
                    <button mat-raised-button (click)="cleanFilter()">
                        Limpiar</button>
                </div>
            </mat-expansion-panel>
        </div>
        <div class=" col-md-12">
            <mat-card>
                <div class="row col-md-12">
                    <p>Pedidos</p>
                    <div class=" col-md-12 overflowDiv">

                        <table mat-table class=" " [dataSource]="jsonPaginationPedido.dataSource" >
                            <ng-container matColumnDef="folio">
                                <th mat-header-cell *matHeaderCellDef> Folio </th>
                                <td mat-cell *matCellDef="let element"> {{element.folio}} </td>
                            </ng-container>
                            <ng-container matColumnDef="cliente">
                                <th mat-header-cell *matHeaderCellDef> Cliente </th>
                                <td mat-cell *matCellDef="let element"> {{element.cliente}} </td>
                            </ng-container>
                            <ng-container matColumnDef="contacto">
                                <th mat-header-cell *matHeaderCellDef> Contacto </th>
                                <td mat-cell *matCellDef="let element"> {{element.telefono}} </td>
                            </ng-container>
                            <ng-container matColumnDef="descripcion">
                                <th mat-header-cell *matHeaderCellDef> Descripci&oacute;n </th>
                                <td mat-cell *matCellDef="let element"> {{element.descripcion}} </td>
                            </ng-container>
                            <ng-container matColumnDef="estatus">
                                <th mat-header-cell *matHeaderCellDef> Estatus </th>
                                <td mat-cell *matCellDef="let element"> {{element.catEstatus.estatus}} </td>
                            </ng-container>
                            <ng-container matColumnDef="fec_pedido">
                                <th mat-header-cell *matHeaderCellDef> Fec. del pedido </th>
                                <td mat-cell *matCellDef="let element"> {{element.fec_pedido | date: 'dd/MM/yyyy'}} </td>
                            </ng-container>
                            <ng-container matColumnDef="fec_entregado">
                                <th mat-header-cell *matHeaderCellDef> Fec. entregado </th>
                                <td mat-cell *matCellDef="let element"> {{element.fec_entregado | date: 'dd/MM/yyyy'}} </td>
                            </ng-container>
                            <ng-container matColumnDef="monto_ant">
                                <th mat-header-cell *matHeaderCellDef> Monto de anticipo </th>
                                <td mat-cell *matCellDef="let element"> {{element.monto_ant}} </td>
                            </ng-container>
                            <ng-container matColumnDef="monto_total">
                                <th mat-header-cell *matHeaderCellDef> Costo total </th>
                                <td mat-cell *matCellDef="let element"> {{element.monto_total}} </td>
                            </ng-container>
                            <ng-container matColumnDef="monto_pendiente">
                                <th mat-header-cell *matHeaderCellDef> Monto pendiente </th>
                                <td mat-cell *matCellDef="let element"> {{element.monto_total - element.monto_ant}} </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="pedidoColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: pedidoColumns;let i = index" 
                            [ngClass]="{'greenColor':row.catEstatus.estatus =='ENTREGADO',
                                'redColor':row.catEstatus.estatus =='PENDIENTE',
                                'rowSelected' : rowsSelected.idxOrder== (i+1)}"
                            (click)="consultProd(row, (i+1))"></tr>
                        </table>
                        
                        <!--<pagination-controls (pageChange)="pageChange($event)"></pagination-controls>-->
                    </div>
                    <mat-paginator [length]="jsonPaginationPedido.totalItems" 
                            [pageSize]="jsonPaginationPedido.pageSize"
                            [pageSizeOptions]="jsonPaginationPedido.pageSizeOptions"
                            (page)="pageEvent = getServerDataPedido($event)" style="width: 100%;">
                    </mat-paginator>
                </div>
            </mat-card>
        </div>
        <div class=" col-md-12">
            <mat-card>
                <div class="row col-md-12">
                    <p>Productos</p>
                    <div class=" col-md-12 overflowDiv">
                        <table mat-table class=" " [dataSource]="jsonPaginationProd.dataSource">
                            <ng-container matColumnDef="bar_code">
                                <th mat-header-cell *matHeaderCellDef> C&oacute;digo Barras </th>
                                <td mat-cell *matCellDef="let element"> {{element.bar_code}} </td>
                            </ng-container>
                            <ng-container matColumnDef="descripcion">
                                <th mat-header-cell *matHeaderCellDef> Descripci&oacute;n </th>
                                <td mat-cell *matCellDef="let element"> {{element.descripcion}} </td>
                            </ng-container>
                            <ng-container matColumnDef="cantidad">
                                <th mat-header-cell *matHeaderCellDef> Cantidad </th>
                                <td mat-cell *matCellDef="let element"> {{element.cantidad}} </td>
                            </ng-container>
                            <ng-container matColumnDef="costo_unitario">
                                <th mat-header-cell *matHeaderCellDef> Costo Unitario </th>
                                <td mat-cell *matCellDef="let element"> {{element.costo_unitario}} </td>
                            </ng-container>
                            <ng-container matColumnDef="costo_total">
                                <th mat-header-cell *matHeaderCellDef> Costo total </th>
                                <td mat-cell *matCellDef="let element"> {{element.costo_total}} </td>
                            </ng-container>
                            <ng-container matColumnDef="estatus">
                                <th mat-header-cell *matHeaderCellDef> Estatus </th>
                                <td mat-cell *matCellDef="let element"> {{element.estatus}} </td>
                            </ng-container>
                            
                            <tr mat-header-row *matHeaderRowDef="prodsPedidoColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: prodsPedidoColumns;"
                            [ngClass]="{'greenColor':row.estatus =='TERMINADO',
                                'redColor':row.estatus =='PENDIENTE'}"></tr>
                           
                        </table>
                        
                    </div>
                    <mat-paginator [length]="jsonPaginationProd.totalItems" 
                            [pageSize]="jsonPaginationProd.pageSize"
                            [pageSizeOptions]="jsonPaginationProd.pageSizeOptions"
                            (page)="pageEvent = getServerDataProd($event)" style="width: 100%;">
                        </mat-paginator>
                </div>
            </mat-card>
        </div>
    </div>
    <pre>jsonPagination = {{jsonPaginationPedido | json}}</pre>
</article>